<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Jdbi 3 Developer Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Jdbi 3 Developer Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_to_jdbi">1. Introduction to Jdbi</a>
<ul class="sectlevel2">
<li><a href="#_fluent_api">1.1. Fluent API</a></li>
<li><a href="#_declarative_api">1.2. Declarative API</a></li>
</ul>
</li>
<li><a href="#_setting_up_jdbi">2. Setting Up Jdbi</a></li>
<li><a href="#_basic_usage">3. Basic Usage</a>
<ul class="sectlevel2">
<li><a href="#_jdbi">3.1. Jdbi</a></li>
<li><a href="#_handle">3.2. Handle</a></li>
<li><a href="#_parameters">3.3. Parameters</a>
<ul class="sectlevel3">
<li><a href="#_positional_parameters">3.3.1. Positional Parameters</a></li>
<li><a href="#_named_parameters">3.3.2. Named Parameters</a></li>
<li><a href="#_supported_types">3.3.3. Supported Types</a></li>
<li><a href="#_binding_parameters">3.3.4. Binding Parameters</a></li>
</ul>
</li>
<li><a href="#_sql_objects">3.4. SQL Objects</a>
<ul class="sectlevel3">
<li><a href="#_annotated_methods">3.4.1. Annotated Methods</a></li>
<li><a href="#_default_methods">3.4.2. Default Methods</a></li>
<li><a href="#_using_your_sql_object_type">3.4.3. Using your SQL Object type</a></li>
</ul>
</li>
<li><a href="#_row_mappers">3.5. Row Mappers</a></li>
<li><a href="#_statements">3.6. Statements</a>
<ul class="sectlevel3">
<li><a href="#_query">3.6.1. Query</a></li>
<li><a href="#_update">3.6.2. Update</a></li>
<li><a href="#_script">3.6.3. Script</a></li>
<li><a href="#_call">3.6.4. Call</a></li>
<li><a href="#_batch">3.6.5. Batch</a></li>
</ul>
</li>
<li><a href="#_arguments">3.7. Arguments</a></li>
<li><a href="#_results">3.8. Results</a>
<ul class="sectlevel3">
<li><a href="#_row_mapper">3.8.1. Row Mapper</a></li>
<li><a href="#_column_mapper">3.8.2. Column Mapper</a></li>
<li><a href="#_bean_mapper">3.8.3. Bean Mapper</a></li>
<li><a href="#_annotations">3.8.4. Annotations</a></li>
<li><a href="#_resultbearing">3.8.5. ResultBearing</a></li>
<li><a href="#_joins">3.8.6. Joins</a></li>
<li><a href="#_generated_keys">3.8.7. Generated Keys</a></li>
</ul>
</li>
<li><a href="#_transactions">3.9. Transactions</a>
<ul class="sectlevel3">
<li><a href="#_transactions_in_the_fluent_api">3.9.1. Transactions in the Fluent API</a></li>
<li><a href="#_transactions_in_sqlobject_api">3.9.2. Transactions in SqlObject API</a></li>
<li><a href="#_serializable_transactions">3.9.3. Serializable Transactions</a></li>
</ul>
</li>
<li><a href="#_batch_updates">3.10. Batch Updates</a></li>
<li><a href="#_exception_rewriting">3.11. Exception Rewriting</a></li>
</ul>
</li>
<li><a href="#_sqlobject">4. SqlObject</a>
<ul class="sectlevel2">
<li><a href="#__singlevalue">4.1. @SingleValue</a></li>
<li><a href="#_sql_locators">4.2. Sql Locators</a></li>
</ul>
</li>
<li><a href="#_third_party_integration">5. Third Party Integration</a>
<ul class="sectlevel2">
<li><a href="#_spring">5.1. Spring</a></li>
<li><a href="#_google_guava">5.2. Google Guava</a></li>
<li><a href="#_postgresql">5.3. PostgreSQL</a></li>
<li><a href="#_oracle">5.4. Oracle</a></li>
<li><a href="#_kotlin">5.5. Kotlin</a>
<ul class="sectlevel3">
<li><a href="#_resultset_mapping">5.5.1. ResultSet mapping</a></li>
<li><a href="#_sqlobject_2">5.5.2. SqlObject</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_appendix">6. Appendix</a>
<ul class="sectlevel2">
<li><a href="#_api_reference">6.1. API Reference</a></li>
<li><a href="#_contributing">6.2. Contributing</a></li>
</ul>
</li>
<li><a href="#_leftover_snippets">7. Leftover snippets</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction_to_jdbi"><a class="anchor" href="#_introduction_to_jdbi"></a>1. Introduction to Jdbi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>Jdbi</strong> library provides convenient, idiomatic access to relational data in Java.</p>
</div>
<div class="paragraph">
<p>Jdbi is built on top of JDBC. If your database has a JDBC driver, you can use Jdbi with it.</p>
</div>
<div class="paragraph">
<p>Jdbi&#8217;s API comes in two flavors:</p>
</div>
<div class="sect2">
<h3 id="_fluent_api"><a class="anchor" href="#_fluent_api"></a>1.1. Fluent API</h3>
<div class="paragraph">
<p>The Core API provides a fluent, imperative interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jdbi jdbi = Jdbi.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:test</span><span class="delimiter">&quot;</span></span>); <span class="comment">// (H2 in-memory database)</span>

<span class="predefined-type">List</span>&lt;User&gt; users = jdbi.withHandle(handle -&gt; {
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE user (id INTEGER PRIMARY KEY, name VARCHAR)</span><span class="delimiter">&quot;</span></span>);

    <span class="comment">// Inline positional parameters</span>
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);

    <span class="comment">// Positional parameters</span>
    handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (?, ?)</span><span class="delimiter">&quot;</span></span>)
            .bind(<span class="integer">0</span>, <span class="integer">1</span>) <span class="comment">// 0-based parameter indexes</span>
            .bind(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>)
            .execute();

    <span class="comment">// Named parameters</span>
    handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (:id, :name)</span><span class="delimiter">&quot;</span></span>)
            .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
            .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Clarice</span><span class="delimiter">&quot;</span></span>)
            .execute();

    <span class="comment">// Named parameters from bean properties</span>
    handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (:id, :name)</span><span class="delimiter">&quot;</span></span>)
            .bindBean(<span class="keyword">new</span> User(<span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">David</span><span class="delimiter">&quot;</span></span>))
            .execute();

    <span class="comment">// Easy mapping to your types</span>
    <span class="keyword">return</span> handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user ORDER BY id</span><span class="delimiter">&quot;</span></span>)
            .mapToBean(User.class)
            .list();
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_declarative_api"><a class="anchor" href="#_declarative_api"></a>1.2. Declarative API</h3>
<div class="paragraph">
<p>The SQL Object API sits atop Core, and provides a declarative interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Define your own declarative interface</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE user (id INTEGER PRIMARY KEY, name VARCHAR)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> createTable();

    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (:id, :name)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> insertUser(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> id, <span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name);

    <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (:id, :name)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> insertUsers(<span class="annotation">@BindBean</span> User... users);

    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user ORDER BY id</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@RegisterBeanMapper</span>(User.class)
    <span class="predefined-type">List</span>&lt;User&gt; listUsers();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jdbi jdbi = Jdbi.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:test</span><span class="delimiter">&quot;</span></span>);
jdbi.installPlugin(<span class="keyword">new</span> SqlObjectPlugin());

<span class="comment">// Jdbi implements your interface based on annotations</span>
<span class="predefined-type">List</span>&lt;User&gt; users = jdbi.withExtension(UserDao.class, dao -&gt; {
    dao.createTable();

    dao.insertUser(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);
    dao.insertUsers(<span class="keyword">new</span> User(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>), <span class="keyword">new</span> User(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Clarice</span><span class="delimiter">&quot;</span></span>), <span class="keyword">new</span> User(<span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">David</span><span class="delimiter">&quot;</span></span>));

    <span class="keyword">return</span> dao.listUsers();
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jdbi has a flexible plugin architecture which makes it easy to fold in support
for your favorite libraries (Guava, JodaTime, Spring) or database vendor (Oracle,
Postgres).</p>
</div>
<div class="paragraph">
<p>Jdbi is not an ORM. There is no session cache, change tracking, "open session in
view", or cajoling the library to understand your schema.</p>
</div>
<div class="paragraph">
<p>Instead, Jdbi provides easy mapping between SQL and simple tabular data structures.</p>
</div>
<div class="paragraph">
<p>You bring your own SQL, and Jdbi only runs the commands you tell it to&#8212;&#8203;the way God intended.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jdbi 3 is currently in beta. While we are reasonably confident in its
quality, we recommend thoroughly testing your code with Jdbi 3 before using it in
a production environment. <a href="http://www.jdbi.org">jdbi2</a> is still the stable release.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_jdbi"><a class="anchor" href="#_setting_up_jdbi"></a>2. Setting Up Jdbi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jdbi is easy to include in your Java project - with an
<a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache 2.0</a> license,
few external dependencies, and JARs distributed through
<a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.jdbi%22%20AND%20v%3A%223.0.0-beta1%22">Maven Central</a>,
you can just include the relevant artifacts in your POM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>jdbi3-parent<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
      <span class="tag">&lt;version&gt;</span>3.0.0-beta1<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span>

<span class="tag">&lt;dependencies&gt;</span>
  <span class="comment">&lt;!-- The core library --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- All other dependencies are optional --&gt;</span>

  <span class="comment">&lt;!-- SQL Object extension -- most people use this --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-sqlobject<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- Support Guava Optional and collection types--&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-guava<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- Support JodaTime v2's DateTime --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-jodatime2<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- Minimal support for JPA annotations. --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-jpa<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- Automatically map kotlin data classes --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-kotlin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- Support Kotlin default methods, default parameters in SQL Object --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-kotlin-sqlobject<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- Support Oracle returning DML statements --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-oracle12<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- Adds support for most data types supported by Postgres driver --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-postgres<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- A factory bean to set up Jdbi singleton --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-spring4<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>

  <span class="comment">&lt;!-- Use StringTemplate4 template engine, instead of JDBI's --&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-stringtemplate4<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_usage"><a class="anchor" href="#_basic_usage"></a>3. Basic Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_jdbi"><a class="anchor" href="#_jdbi"></a>3.1. Jdbi</h3>
<div class="paragraph">
<p>The <code>Jdbi</code> object is the main entry point into the library.</p>
</div>
<div class="paragraph">
<p>Each <code>Jdbi</code> instance wraps a JDBC
<a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a>.
It is also a repository of configuration for your database session.</p>
</div>
<div class="paragraph">
<p>There are a few ways to open a <code>Jdbi</code> instance. You can use a JDBC url:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// H2 in-memory database</span>
Jdbi jdbi = Jdbi.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:test</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a <code>DataSource</code> object, you can use that directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">DataSource</span> ds = ...
Jdbi jdbi = Jdbi.create(ds);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Jdbi</code> instances are thread-safe and do not own any database resources.</p>
</div>
<div class="paragraph">
<p>Typically an application will create one shared <code>Jdbi</code> instance
application-wide, and set up any shared configuration there.</p>
</div>
<div class="paragraph">
<p>In a more limited scope (such as an HTTP request, or event callback),
you would then request a <code>Handle</code> object from your <code>Jdbi</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handle"><a class="anchor" href="#_handle"></a>3.2. Handle</h3>
<div class="paragraph">
<p>Handles are used to prepare and run SQL statements against the database.</p>
</div>
<div class="paragraph">
<p><code>Handle</code> provides access to fluent statement APIs that can bind parameters, and map results to and from regular Java objects.</p>
</div>
<div class="paragraph">
<p><code>Handle</code> represents an active <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html">database connection</a>
and inherits configuration from the <code>Jdbi</code> at the time of creation.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Because <code>Handle</code> holds an open connection, care must be taken to ensure
that each handle is closed when you are done with it. Failure to close
Handles will eventually overwhelm your database with connections, or
drain your connection pool.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can obtain a <code>Handle</code> in three different ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jdbi.open()</code></p>
</li>
<li>
<p><code>jdbi.useHandle(HandleConsumer)</code>, or</p>
</li>
<li>
<p><code>jdbi.withHandle(HandleCallback)</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You may notice the "consumer" vs "callback" naming pattern in a few
places in Jdbi. Callbacks return a value, whereas Consumers have a
void return type. Thus, if your operation has a result, use
<code>withHandle</code> instead of <code>useHandle</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can call <code>jdbi.open()</code> to get a <code>Handle</code> instance, but most
of the time you should just use the <code>Jdbi.useHandle</code> or
<code>Jdbi.withHandle</code> callback methods, which ensure that the handle
is cleaned up, and the connection released before returning to
the caller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.useHandle(handle -&gt; {
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">create table contacts (id int primary key, name varchar(100))</span><span class="delimiter">&quot;</span></span>);
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);
});

<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; names = jdbi.withHandle(handle -&gt;
    handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from contacts</span><span class="delimiter">&quot;</span></span>)
          .mapTo(<span class="predefined-type">String</span>.class)
          .list());
assertThat(names).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>jdbi.open()</code>, we recommend doing so in a
try-with-resources block for safety.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (Handle handle = jdbi.open()) {
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Chuck</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parameters"><a class="anchor" href="#_parameters"></a>3.3. Parameters</h3>
<div class="paragraph">
<p>You have two choices when binding parameters to a SQL statement: positional, or named.</p>
</div>
<div class="paragraph">
<p>Any statement can use either position or named parameters, but they can never be mixed in the same SQL statement.
In this case, Jdbi can&#8217;t be sure it&#8217;s binding the right parameters, and will throw an exception.</p>
</div>
<div class="sect3">
<h4 id="_positional_parameters"><a class="anchor" href="#_positional_parameters"></a>3.3.1. Positional Parameters</h4>
<div class="paragraph">
<p>When you use a <code>?</code> token in a SQL statement, Jdbi replaces it with the value you bind to the corresponding index (0-based):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Contact thing = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts where id = ?</span><span class="delimiter">&quot;</span></span>)
                      .bind(<span class="integer">0</span>, id)
                      .mapTo(Contact.class)
                      .findOnly();
assertThat(thing).extracting(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)
                 .contains(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_named_parameters"><a class="anchor" href="#_named_parameters"></a>3.3.2. Named Parameters</h4>
<div class="paragraph">
<p>When you use a colon-prefixed token like <code>:name</code> in a SQL statement, Jdbi replaces it with the value you bind to that name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Contact thing = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts where id = :id</span><span class="delimiter">&quot;</span></span>)
                      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
                      .mapTo(Contact.class)
                      .findOnly();
assertThat(thing).extracting(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)
                 .contains(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_supported_types"><a class="anchor" href="#_supported_types"></a>3.3.3. Supported Types</h4>
<div class="paragraph">
<p>Out of the box, Jdbi supports the following types as SQL statement parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Primitives: boolean, byte, char, double, float, int, long, short</p>
</li>
<li>
<p>java.lang: Boolean, Byte, Character, Double, Enum (stored as the enum value&#8217;s name), Float, Integer, Long, Short, String</p>
</li>
<li>
<p>java.math: BigDecimal</p>
</li>
<li>
<p>java.net: Inet4Address, Inet6Address, URL, URI</p>
</li>
<li>
<p>java.sql: Blob, Clob, Date, Time, Timestamp</p>
</li>
<li>
<p>java.time: Instant, LocalDate, LocalDateTime, LocalTime, OffsetDateTime, ZonedDateTime</p>
</li>
<li>
<p>java.util: Date, Optional (around any other supported type), UUID</p>
</li>
<li>
<p>java.util.Collection and Java arrays (stored as SQL arrays). Some additional setup may be required depending on the type of array element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also configure Jdbi to support additional parameter types. More on that later.</p>
</div>
</div>
<div class="sect3">
<h4 id="_binding_parameters"><a class="anchor" href="#_binding_parameters"></a>3.3.4. Binding Parameters</h4>
<div class="paragraph">
<p>SQL statement parameters can be bound in a few different ways.</p>
</div>
<div class="paragraph">
<p>You can bind parameters individually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can bind from the entries of a <code>Map</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);

handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bindMap(contact)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can bind from properties of a Java Bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Contact contact = Contact();
contact.setId(<span class="integer">3</span>);
contact.withName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cindy</span><span class="delimiter">&quot;</span></span>);

handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bindBean(contact)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally qualify each bound bean with a prefix.
This can be handy when binding multiple beans with similar property names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Folder folder = <span class="keyword">new</span> Folder(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Important Documents</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Document</span> document = <span class="keyword">new</span> <span class="predefined-type">Document</span>(<span class="integer">100</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">memo.txt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Business business business. Numbers.</span><span class="delimiter">&quot;</span></span>);

handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into documents (id, folder_id, name, contents) </span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">values (:d.id, :f.id, :d.name, :d.contents)</span><span class="delimiter">&quot;</span></span>)
      .bindBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">f</span><span class="delimiter">&quot;</span></span>, folder)
      .bindBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span>, document)
      .execute()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sql_objects"><a class="anchor" href="#_sql_objects"></a>3.4. SQL Objects</h3>
<div class="paragraph">
<p>With the SQL Object API, you author an interface with methods for different database operations.
<strong>Jdbi</strong> can then synthesize an implementation for you.</p>
</div>
<div class="sect3">
<h4 id="_annotated_methods"><a class="anchor" href="#_annotated_methods"></a>3.4.1. Annotated Methods</h4>
<div class="paragraph">
<p>Most of the time, your SQL methods will use annotations to declare what they do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContactDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name, phone) values (nextval('contact_seq'), :name, :phone)</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@GetGeneratedKeys</span>
  <span class="type">long</span> insert(<span class="annotation">@BindBean</span> Contact contact);

  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name, phone) values (nextval('contact_seq'), :name, :phone)</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@GetGeneratedKeys</span>
  <span class="type">long</span><span class="type">[]</span> batchInsert(<span class="annotation">@BindBean</span> <span class="predefined-type">Iterable</span>&lt;Contact&gt; contacts);

  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts where id = :id</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterBeanMapper</span>(Contact.class)
  Contact getById(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="type">long</span> contactId);

  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterBeanMapper</span>(Contact.class)
  <span class="predefined-type">List</span>&lt;Contact&gt; list();

  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">update contacts set name = :name, phone = :phone where id = :id</span><span class="delimiter">&quot;</span></span>)
  <span class="type">boolean</span> update(<span class="annotation">@BindBean</span> Contact contact);

  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete from contacts where id = ?</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> delete(<span class="type">long</span> id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s briefly cover what these annotations mean. We&#8217;ll go into great detail later on.</p>
</div>
<div class="paragraph">
<p>Method annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@SqlUpdate</code> - execute a statement, and return the update count (i.e. the number of rows modified).</p>
</li>
<li>
<p><code>@SqlBatch</code> - execute a statement multiple times, using a series of input parameters. Any array,
vararg, or iterable parameters are interpreted as sequential inputs to the batch.</p>
</li>
<li>
<p><code>@SqlQuery</code> - execute a statement, and map the result set to the method return type. Query methods
may return single value types (which returns the first row of the result), or a collection of rows.</p>
</li>
<li>
<p><code>@GetGeneratedKeys</code> - Return the keys generated by the SQL statement, instead of the update count.
In the above example, this means returning the next value from the <code>contact_seq</code> sequence.
This annotation modifies the return type of <code>@SqlUpdate</code> or <code>@SqlBatch</code> method.</p>
</li>
<li>
<p><code>@RegisterBeanMapper</code> - Tells Jdbi that result sets can be mapped to the given class
(<code>Contact.class</code> in this case) by treating column names as bean properties. Any columns in
<code>snake_case</code> are matched automatically to the equivalent <code>camelCase</code> property names.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Parameter annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Bind</code> - Bind the argument to the SQL statement.</p>
<div class="ulist">
<ul>
<li>
<p>If the SQL statement uses positional parameters, the argument is bound to the index of the
parameter in the method argument list.</p>
</li>
<li>
<p>If the SQL statement uses named parameters, the argument is bound to the name provided with the
annotation, e.g. <code>@Bind("id") long contactId</code> binds to <code>id</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>@BindBean</code> - Bind from the JavaBean properties of the argument.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A parameter without an annotation will be treated as if it were annotated with <code>@Bind</code>.</p>
</div>
<div class="sect4">
<h5 id="_automatic_parameter_naming"><a class="anchor" href="#_automatic_parameter_naming"></a>Automatic parameter naming</h5>
<div class="paragraph">
<p>Normally, you need to explicitly provide the name to bind in each <code>@Bind</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts where id = :id</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Contact getById(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="type">long</span> id);</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if you enable the <code>-parameters</code> compiler flag, <code>javac</code> will write parameter names
to the compiled class, where Jdbi can access them through reflection. This spares you having to
repeat parameter names in annotations. Thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts where id = :id</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Contact getById(<span class="type">long</span> id);</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_maven_setup"><a class="anchor" href="#_maven_setup"></a>Maven setup</h6>
<div class="paragraph">
<p>Configure the <code>maven-compiler-plugin</code> in your POM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;compilerArgs&gt;</span>
            <span class="tag">&lt;arg&gt;</span>-parameters<span class="tag">&lt;/arg&gt;</span>
        <span class="tag">&lt;/compilerArgs&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_intellij_idea_setup"><a class="anchor" href="#_intellij_idea_setup"></a>IntelliJ IDEA setup</h6>
<div class="ulist">
<ul>
<li>
<p>File &#8594; Settings</p>
</li>
<li>
<p>Build, Execution, Deployment &#8594; Compiler &#8594; Java Compiler</p>
</li>
<li>
<p>Additional command-line parameters: <code>-parameters</code></p>
</li>
<li>
<p>Click Apply, then OK.</p>
</li>
<li>
<p>Build &#8594; Rebuild Project</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_eclipse_setup"><a class="anchor" href="#_eclipse_setup"></a>Eclipse setup</h6>
<div class="ulist">
<ul>
<li>
<p>Window &#8594; Preferences</p>
</li>
<li>
<p>Java &#8594; Compiler</p>
</li>
<li>
<p>Under "Classfile Generation," check the option "Store information about method parameters (usable via reflection)."</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_default_methods"><a class="anchor" href="#_default_methods"></a>3.4.2. Default Methods</h4>
<div class="paragraph">
<p>On the occasion that the built-in annotations don&#8217;t do what you need, you can always "drop down" to the Core API.</p>
</div>
<div class="paragraph">
<p>Jdbi provides a <code>SqlObject</code> mixin interface with a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SqlObject</span> {
  Handle getHandle();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make your SQL Object interface extend the <code>SqlObject</code> mixin, then provide your own implementation in a default method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SplineDao</span> <span class="directive">extends</span> SqlObject {
  <span class="keyword">default</span> <span class="type">void</span> reticulateSplines(Spline spline) {
    Handle handle = getHandle();
    <span class="comment">// do tricky stuff using the Core API.</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default methods can also be used to group multiple SQL operations into a single method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContactPhoneDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (nextval('contact_id'), :name)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">long</span> insertContact(<span class="annotation">@BindBean</span> Contact contact);

  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into phones (contact_id, type, phone) values (:contactId, :type, :phone)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> insertPhone(<span class="type">long</span> contactId, <span class="annotation">@BindBean</span> <span class="predefined-type">Iterable</span>&lt;Phone&gt; phones);

  <span class="keyword">default</span> <span class="type">long</span> insertFullContact(Contact contact) {
    <span class="type">long</span> id = insertContact(contact);
    insertPhone(id, contact.getPhones());
    <span class="keyword">return</span> id;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_your_sql_object_type"><a class="anchor" href="#_using_your_sql_object_type"></a>3.4.3. Using your SQL Object type</h4>
<div class="paragraph">
<p>Once you&#8217;ve defined your interface, there are a few ways to get an instance of it:</p>
</div>
<div class="sect4">
<h5 id="_attached_to_handle"><a class="anchor" href="#_attached_to_handle"></a>Attached to Handle</h5>
<div class="paragraph">
<p>You can get a SQL Object that is attached to an open handle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (Handle handle = jdbi.open()) {
  ContactPhoneDao dao = handle.attach(ContactPhoneDao.class);
  dao.insertFullContact(contact);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attached SQL Objects have the same lifecycle as the handle&#8212;&#8203;when the handle is closed, the SQL Object becomes unusable.</p>
</div>
</div>
<div class="sect4">
<h5 id="_temporary_sql_objects"><a class="anchor" href="#_temporary_sql_objects"></a>Temporary SQL Objects</h5>
<div class="paragraph">
<p>You can also get a temporary SQL Object from the Jdbi object, by passing it a callback (typically a lambda).
Use <code>Jdbi.withExtension</code> for operations that return a result, or <code>useExtension</code> for operations with no result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.useExtension(ContactPhoneDao.class, dao -&gt; dao.insertFullContact(alice));
<span class="type">long</span> bobId = jdbi.withExtension(ContactPhoneDao.class, dao -&gt; dao.insertFullContact(bob));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Temporary SQL Objects are only valid inside the callback you pass to the method. The SQL Object (and the associated
temporary handle) are closed when the callback returns.</p>
</div>
</div>
<div class="sect4">
<h5 id="_on_demand"><a class="anchor" href="#_on_demand"></a>On-Demand</h5>
<div class="paragraph">
<p>On-demand instances have an open-ended lifecycle, as they obtain and releases connections for each method call.
They are thread-safe, and may be reused across an application. This is handy when you only need to make single
calls at a time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ContactPhoneDao dao = jdbi.onDemand(ContactPhoneDao.class);
<span class="type">long</span> aliceId = dao.insertFullContact(alice);
<span class="type">long</span> bobId = dao.insertFullContact(bob);</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a performance penalty every time a connection is allocated and released. If you need to make
successive calls to a SQL Object, consider using one of the above options for
better performance, instead of on-demand.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_row_mappers"><a class="anchor" href="#_row_mappers"></a>3.5. Row Mappers</h3>
<div class="paragraph">
<p>By default, queries map each row in the result set into a
<code>Map&lt;String, Object&gt;</code> which maps the column name to the column
value. You can override this to map to arbitrary row types
using <code>Query.map(RowMapper&lt;T&gt;)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Contact</span> {
    <span class="directive">final</span> <span class="type">int</span> id;
    <span class="directive">final</span> <span class="predefined-type">String</span> name;

    Contact(<span class="type">int</span> id, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">ContactMapper</span> <span class="directive">implements</span> <span class="predefined-type">RowMapper</span>&lt;Contact&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> Contact map(<span class="predefined-type">ResultSet</span> r, StatementContext ctx) <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> Contact(r.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), r.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
    }
}

    <span class="predefined-type">List</span>&lt;Contact&gt; contacts = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts</span><span class="delimiter">&quot;</span></span>)
                                   .map(<span class="keyword">new</span> ContactMapper())
                                   .list();
    assertThat(contacts).extracting(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)
                        .contains(tuple(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>),
                                  tuple(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Registering a <code>RowMapper</code> with the <code>Handle</code> or the <code>Jdbi</code> (before
the handle is created) allows you to map to the data type
without having to specify the mapper type everywhere:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(<span class="keyword">new</span> ContactMapper());

<span class="predefined-type">List</span>&lt;Contact&gt; contacts = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts</span><span class="delimiter">&quot;</span></span>)
                               .mapTo(Contact.class)
                               .list();
assertThat(contacts).extracting(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)
                    .contains(tuple(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>),
                              tuple(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_statements"><a class="anchor" href="#_statements"></a>3.6. Statements</h3>
<div class="paragraph">
<p><strong>jdbi</strong> provides fluent builders for various types of queries, updates, and
batch statements.</p>
</div>
<div class="sect3">
<h4 id="_query"><a class="anchor" href="#_query"></a>3.6.1. Query</h4>
<div class="paragraph">
<p>A <strong>Query</strong> is a <strong>Statement</strong> that returns a result set from the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;&gt; users =
    handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user ORDER BY id ASC</span><span class="delimiter">&quot;</span></span>)
        .mapToMap()
        .list();

assertThat(users).containsExactly(
        map(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>),
        map(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Queries may have <a href="arguments.html">arguments</a> bound by name or by position.</p>
</div>
<div class="paragraph">
<p>They also have a <a href="#results">#result type</a>.  The default is <strong>Map&lt;String, Object&gt;</strong>.
The keys are column labels, and values are <strong>jdbi</strong>'s best guess at a reasonable type.</p>
</div>
<div class="paragraph">
<p>Declaring a class that closely maps to your database table makes mapping to
or from database rows simple:</p>
</div>
</div>
<div class="sect3">
<h4 id="_update"><a class="anchor" href="#_update"></a>3.6.2. Update</h4>
<div class="paragraph">
<p><strong>Update*s are operations that return an integer number of rows modified,
such as a database *INSERT</strong>, <strong>UPDATE</strong>, or <strong>DELETE</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> count = handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES(:id, :name)</span><span class="delimiter">&quot;</span></span>)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>)
    .execute();
assertThat(count).isEqualTo(<span class="integer">1</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_script"><a class="anchor" href="#_script"></a>3.6.3. Script</h4>
<div class="paragraph">
<p>A <strong>Script</strong> parses a String into semicolon terminated statements.
The statements can be executed in a single <strong>Batch</strong> or individually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span><span class="type">[]</span> results = handle.createScript(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user VALUES(3, 'Charlie');</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE user SET name='Bobby Tables' WHERE id=2;</span><span class="delimiter">&quot;</span></span>)
    .execute();

assertThat(results).containsExactly(<span class="integer">1</span>, <span class="integer">1</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_call"><a class="anchor" href="#_call"></a>3.6.4. Call</h4>
<div class="paragraph">
<p>A <strong>Call</strong> invokes a database stored procedure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.execute(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE FUNCTION the_answer(answer INOUT INTEGER) AS $$</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">BEGIN answer := 42; END;</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">$$ LANGUAGE plpgsql</span><span class="delimiter">&quot;</span></span>);

assertThat(handle.createCall(<span class="string"><span class="delimiter">&quot;</span><span class="content">{? = call the_answer(?)}</span><span class="delimiter">&quot;</span></span>)
        .registerOutParameter(<span class="integer">0</span>, <span class="predefined-type">Types</span>.INTEGER)
        .bind(<span class="integer">1</span>, <span class="integer">13</span>)
        .invoke()
        .getInt(<span class="integer">0</span>))
    .isEqualTo(<span class="integer">42</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This section needs some help, in particular, how the hell
does the out parameter mapping above work?</p>
</div>
</div>
<div class="sect3">
<h4 id="_batch"><a class="anchor" href="#_batch"></a>3.6.5. Batch</h4>
<div class="paragraph">
<p>A <strong>Batch</strong> or <strong>PreparedBatch</strong> sends many rows to the server
in bulk.  After opening the batch, repeatedly add bound
parameters or statements, and invoke <strong>add</strong>.</p>
</div>
<div class="paragraph">
<p>The result is a list of modified row count.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PreparedBatch batch = handle.prepareBatch(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES(:id, :name)</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">100</span>; i &lt; <span class="integer">5000</span>; i++)
{
    batch.bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, i).bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">User:</span><span class="delimiter">&quot;</span></span> + i).add();
}

<span class="type">int</span><span class="type">[]</span> expected = <span class="keyword">new</span> <span class="type">int</span>[<span class="integer">4900</span>];
<span class="predefined-type">Arrays</span>.fill(expected, <span class="integer">1</span>);
assertThat(batch.execute()).isEqualTo(expected);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arguments"><a class="anchor" href="#_arguments"></a>3.7. Arguments</h3>
<div class="paragraph">
<p>Most non-trivial queries require binding arguments from Java land
to the statement.  In addition to binding by index (which is zero-based
in <strong>jdbi</strong>, unlike JDBC&#8217;s bizarre one-indexing scheme), named parameters
are supported out of the box.</p>
</div>
<div class="paragraph">
<p>All primitive and many core Java types come with predefined bindings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> bindInt() {
    assertThat(handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT :id</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
        .mapTo(<span class="predefined-type">Integer</span>.class)
        .findOnly()
        .intValue()).isEqualTo(<span class="integer">3</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You also have a couple of options to deal with custom types.
The <strong>Argument</strong> class wraps a single value into a binding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="type">class</span> <span class="class">UUIDArgument</span> <span class="directive">implements</span> Argument {
    <span class="directive">private</span> <span class="predefined-type">UUID</span> uuid;

    <span class="directive">public</span> UUIDArgument(<span class="predefined-type">UUID</span> uuid) {
        <span class="local-variable">this</span>.uuid = uuid;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(<span class="type">int</span> position, <span class="predefined-type">PreparedStatement</span> statement, StatementContext ctx)
    <span class="directive">throws</span> <span class="exception">SQLException</span> {
        statement.setString(position, uuid.toString()); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> uuidArgument() {
    <span class="predefined-type">UUID</span> u = <span class="predefined-type">UUID</span>.randomUUID();
    assertThat(handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT CAST(:uuid AS VARCHAR)</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> UUIDArgument(u))
        .mapTo(<span class="predefined-type">String</span>.class)
        .findOnly()).isEqualTo(u.toString());
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Since Argument usually directly calls into JDBC directly,
it is given the <strong>one-based index</strong> when it is applied.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here we use an <strong>Argument</strong> to directly bind a UUID.  In this
particular case, the most obvious approach is to send the UUID
to the database as a String.  If your JDBC driver supports custom
types directly or efficient binary transfers, you can leverage them
easily here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="type">class</span> <span class="class">UUIDArgumentFactory</span> <span class="directive">implements</span> ArgumentFactory {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> Optional&lt;Argument&gt; build(<span class="predefined-type">Type</span> type, <span class="predefined-type">Object</span> value, ConfigRegistry config) {
        <span class="keyword">return</span> type == <span class="predefined-type">UUID</span>.class ?
                Optional.of(<span class="keyword">new</span> UUIDArgument((<span class="predefined-type">UUID</span>) value)) :
                    Optional.empty();
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> uuidArgumentFactory() {
    <span class="predefined-type">UUID</span> u = <span class="predefined-type">UUID</span>.randomUUID();
    handle.registerArgument(<span class="keyword">new</span> UUIDArgumentFactory());
    assertThat(handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT CAST(:uuid AS VARCHAR)</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>, u)
        .mapTo(<span class="predefined-type">String</span>.class)
        .findOnly()).isEqualTo(u.toString());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also register <strong>ArgumentFactory</strong> instances which can inspect
the type of bindings and determine if they understand how to convert
the type to Arguments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_results"><a class="anchor" href="#_results"></a>3.8. Results</h3>
<div class="paragraph">
<p>After executing a database query, you need to interpret the results.
JDBC provides the <strong>ResultSet</strong> class which can do simple mapping to
Java primitives and built in classes, but the API is often cumbersome
to use.  <strong>jdbi</strong> provides configurable mapping, including
the ability to register custom mappers for rows and columns.</p>
</div>
<div class="paragraph">
<p>A <strong>RowMapper</strong> converts a row of a <strong>ResultSet</strong> into a result object.</p>
</div>
<div class="paragraph">
<p>A <strong>ColumnMapper</strong> converts a single column&#8217;s value into a Java object.
It can be used as a <strong>RowMapper</strong> if there is only one column present,
or it can be used to build more complex *RowMapper*s.</p>
</div>
<div class="paragraph">
<p>The mapper is selected based on the declared result type of your query.</p>
</div>
<div class="paragraph">
<p><strong>jdbi</strong> iterates over the rows in the ResultSet and presents the mapped results
to you in a container such as a <strong>List</strong>, <strong>Stream</strong>, <strong>Optional</strong>, or <strong>Iterator</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">User</span> {
    <span class="directive">final</span> <span class="type">int</span> id;
    <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> User(<span class="type">int</span> id, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="annotation">@Before</span>
<span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE user (id INTEGER PRIMARY KEY AUTO_INCREMENT, name VARCHAR)</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">for</span> (<span class="predefined-type">String</span> name : <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Data</span><span class="delimiter">&quot;</span></span>)) {
        handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(name) VALUES (?)</span><span class="delimiter">&quot;</span></span>, name);
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> findBob() {
    User u = findUserById(<span class="integer">2</span>).orElseThrow(() -&gt; <span class="keyword">new</span> <span class="exception">AssertionError</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">No user found</span><span class="delimiter">&quot;</span></span>));
    assertThat(u.id).isEqualTo(<span class="integer">2</span>);
    assertThat(u.name).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);
}

<span class="directive">public</span> Optional&lt;User&gt; findUserById(<span class="type">long</span> id) {
    <span class="predefined-type">RowMapper</span>&lt;User&gt; userMapper =
            (rs, ctx) -&gt; <span class="keyword">new</span> User(rs.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
    <span class="keyword">return</span> handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user WHERE id=:id</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, id)
        .map(userMapper)
        .findFirst();
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_row_mapper"><a class="anchor" href="#_row_mapper"></a>3.8.1. Row Mapper</h4>
<div class="paragraph">
<p>The row mapper is called once for every row as <strong>jdbi</strong> iterates
through the result set.</p>
</div>
<div class="paragraph">
<p>Row mappers are either configured on a fluent query, or
can be registered to handle a type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> SELECT_ALL_USERS = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user ORDER BY id ASC</span><span class="delimiter">&quot;</span></span>;

<span class="directive">static</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">UserMapper</span> <span class="directive">implements</span> <span class="predefined-type">RowMapper</span>&lt;User&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> User map(<span class="predefined-type">ResultSet</span> r, StatementContext ctx) <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> User(r.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), r.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> rowMapper() {
    <span class="predefined-type">List</span>&lt;User&gt; users = handle.createQuery(SELECT_ALL_USERS)
        .map(<span class="keyword">new</span> UserMapper())
        .list();

    assertThat(users).hasSize(<span class="integer">4</span>);
    assertThat(users.get(<span class="integer">3</span>).name).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Data</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <strong>RowMapper</strong> is equivalent to the lambda mapper above but more explicit.
We also introduce the <strong>Query.list()</strong> method which collects all rows into a
<strong>List&lt;T&gt;</strong> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> rowMapperFactory() {
    handle.registerRowMapper(<span class="keyword">new</span> RowMapperFactory() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> Optional&lt;<span class="predefined-type">RowMapper</span>&lt;?&gt;&gt; build(<span class="predefined-type">Type</span> type, ConfigRegistry config) {
            <span class="keyword">return</span> type == User.class ?
                    Optional.of(<span class="keyword">new</span> UserMapper()) :
                        Optional.empty();
        }
    });

    <span class="keyword">try</span> (Stream&lt;User&gt; s = handle.createQuery(SELECT_ALL_USERS)
        .mapTo(User.class)
        .stream())
    {
        assertThat(s.filter(u -&gt; u.id &gt; <span class="integer">2</span>)
            .map(u -&gt; u.name)
            .findFirst()).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Factory is allowed to consider whether it can handle any given <strong>Type</strong>
and provides the above RowMapper to do the actual work.</p>
</div>
<div class="paragraph">
<p><strong>Stream</strong> integration allows you to use a RowMapper to adapt a ResultSet into
the new Java 8 Streams framework.  As long as your database supports streaming
results (for example, PostgreSQL will do it as long as you are in a transaction
and set a fetch size), the stream will lazily fetch rows from the database as
necessary.</p>
</div>
<div class="sect4">
<h5 id="_constructor_mapper"><a class="anchor" href="#_constructor_mapper"></a>Constructor Mapper</h5>
<div class="paragraph">
<p><strong>jdbi</strong> provides a simple constructor mapper which uses reflection to assign
columns to constructor parameters by name.  Unfortunately parameter names
are not enabled by default and require a compiler option, but once you
have that enabled the result is quite concise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> constructorMapper() {
    handle.registerRowMapper(ConstructorMapper.factory(User.class));
    <span class="predefined-type">Set</span>&lt;User&gt; userSet = handle.createQuery(SELECT_ALL_USERS)
        .mapTo(User.class)
        .collect(Collectors.toSet());

    assertThat(userSet).hasSize(<span class="integer">4</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parameter names "id", "name" match the database column names
and as such no custom mapper code is required at all.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_column_mapper"><a class="anchor" href="#_column_mapper"></a>3.8.2. Column Mapper</h4>
<div class="paragraph">
<p>Sometimes you only wish to fetch a single value, or need
to build a larger object out of multiple individually mappable
elements.  A column mapper works on a single column instead of
by row:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">UserName</span> {
    <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> UserName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">NamedUser</span> {
    <span class="directive">final</span> <span class="type">int</span> id;
    <span class="directive">final</span> UserName name;

    <span class="directive">public</span> NamedUser(<span class="type">int</span> id, UserName name) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="directive">final</span> ColumnMapperFactory userNameFactory = ColumnMapperFactory.of(UserName.class, (rs, index, cx) -&gt; <span class="keyword">new</span> UserName(rs.getString(index)));

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> columnMapper() {
    handle.registerColumnMapper(userNameFactory);
    handle.registerRowMapper(ConstructorMapper.factory(NamedUser.class));

    NamedUser bob = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user WHERE name = :name</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>)
        .mapTo(NamedUser.class)
        .findOnly();

    assertThat(bob.name.name).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the ConstructorMapper, which usually would not know
what to do with a custom <strong>UserName</strong> object, now automatically
uses the column mapper to fill in the constructor parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bean_mapper"><a class="anchor" href="#_bean_mapper"></a>3.8.3. Bean Mapper</h4>
<div class="paragraph">
<p>We also provide basic support for beans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">UserBean</span> {
    <span class="directive">private</span> <span class="type">int</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> <span class="type">int</span> getId() {
        <span class="keyword">return</span> id;
    }
    <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">int</span> id) {
        <span class="local-variable">this</span>.id = id;
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }
    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> beanMapper() {
    UserBean charlie = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user WHERE name = :name</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>)
        .mapToBean(UserBean.class)
        .findOnly();

    assertThat(charlie.getName()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_annotations"><a class="anchor" href="#_annotations"></a>3.8.4. Annotations</h4>
<div class="paragraph">
<p>You can register mappers declaratively on SqlObjects using e.g.
<code>@RegisterRowMapper</code>, <code>@RegisterColumnMapper</code>, <code>@RegisterConstructorMapper</code>,
and so on.</p>
</div>
</div>
<div class="sect3">
<h4 id="_resultbearing"><a class="anchor" href="#_resultbearing"></a>3.8.5. ResultBearing</h4>
<div class="paragraph">
<p>The <strong>ResultBearing</strong> interface determines how the statement results
are gathered and returned to you.  The methods are designed to
interact well with the new Java 8 <strong>@FunctionalInterface*s and
*Stream</strong> library.  Given a type T that can be mapped by the registered
mappers,</p>
</div>
<div class="sect4">
<h5 id="_find_a_single_result"><a class="anchor" href="#_find_a_single_result"></a>Find a Single Result</h5>
<div class="paragraph">
<p><strong>ResultBearing#findOnly</strong> returns the only row in the result set.  If zero
or multiple rows are encountered, it will throw <strong>IllegalStateException</strong>.</p>
</div>
<div class="paragraph">
<p><strong>#findFirst</strong> returns an <strong>Optional&lt;T&gt;</strong> with the first row, if any.</p>
</div>
</div>
<div class="sect4">
<h5 id="_stream"><a class="anchor" href="#_stream"></a>Stream</h5>
<div class="paragraph">
<p><strong>#stream</strong> returns a <strong>Stream&lt;T&gt;</strong>.  You should then process the stream and
produce a result.  This stream must be closed to release any database
resources held, so we recommend using a <strong>try-with-resources</strong> block to
ensure that no resources are leaked.</p>
</div>
<div class="paragraph">
<p><strong>#withStream</strong> and <strong>#useStream</strong> handle closing the stream for you.  You
provide a <strong>StreamCallback</strong> that produces a result or a <strong>StreamConsumer</strong>
that produces no result, respectively.</p>
</div>
</div>
<div class="sect4">
<h5 id="_collections"><a class="anchor" href="#_collections"></a>Collections</h5>
<div class="paragraph">
<p><strong>#list</strong> emits a <strong>List&lt;T&gt;</strong>.  This necessarily buffers all results in memory.</p>
</div>
<div class="paragraph">
<p><strong>#collect</strong> takes a <strong>Collector&lt;T, ? , R&gt;</strong> that builds a resulting collection
<strong>R&lt;T&gt;</strong>.  The <strong>java.util.stream.Collectors</strong> class has a number of interesting
*Collector*s to start with.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reduction"><a class="anchor" href="#_reduction"></a>Reduction</h5>
<div class="paragraph">
<p><strong>#reduce</strong> provides a simplified <strong>Stream#reduce</strong>.  Given an identity
starting value and a <strong>BiFunction&lt;U, T, U&gt;</strong> it will repeatedly combine
*U*s until only a single remains, and then return that.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_joins"><a class="anchor" href="#_joins"></a>3.8.6. Joins</h4>
<div class="paragraph">
<p>Joining multiple tables together is a very common database
task.  It is also where the mismatch between the relational
model and Java&#8217;s object model starts to rear its ugly head.</p>
</div>
<div class="paragraph">
<p>Here we present a couple of strategies for retrieving
results from more complicated rows.</p>
</div>
<div class="sect4">
<h5 id="_joinrowmapper"><a class="anchor" href="#_joinrowmapper"></a>JoinRowMapper</h5>
<div class="paragraph">
<p>The JoinRowMapper takes a set of types to extract from each row.
It uses the mapping registry to determine how to map each given
type, and presents you with a JoinRow that holds all of the resulting
values.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider two simple types, User and Article, with a join
table named Author.  Guava provides a Multimap class which is very
handy for representing joined tables like this.
Assuming we have mappers already registered:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">h.registerRowMapper(ConstructorMapper.factory(User.class));
h.registerRowMapper(ConstructorMapper.factory(Article.class));</code></pre>
</div>
</div>
<div class="paragraph">
<p>we can then easily populate a Multimap with the mapping
from the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Multimap&lt;User, Article&gt; joined = HashMultimap.create();
h.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user NATURAL JOIN author NATURAL JOIN article</span><span class="delimiter">&quot;</span></span>)
    .map(JoinRowMapper.forTypes(User.class, Article.class))
    .forEach(jr -&gt; joined.put(jr.get(User.class), jr.get(Article.class)));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While this approach is easy to read and write, it
can be inefficient for certain patterns of data.
Consider performance requirements when deciding whether
to use high level mapping or more direct low level access
with handwritten mappers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use it with SqlObject:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testSqlObjectJoinRow()
{
    UserArticleDao dao = dbRule.getSharedHandle().attach(UserArticleDao.class);
    Multimap&lt;User, Article&gt; joined = HashMultimap.create();
    dao.getAuthorship()
        .forEach(jr -&gt; joined.put(jr.get(User.class), jr.get(Article.class)));
    assertThat(joined).isEqualTo(JoinRowMapperTest.getExpected());
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserArticleDao</span>
{
    <span class="annotation">@RegisterJoinRowMapper</span>({User.class, Article.class})
    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user NATURAL JOIN author NATURAL JOIN article</span><span class="delimiter">&quot;</span></span>)
    Stream&lt;JoinRow&gt; getAuthorship();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generated_keys"><a class="anchor" href="#_generated_keys"></a>3.8.7. Generated Keys</h4>
<div class="paragraph">
<p>Inserts and related queries may automatically generate keys.  These keys are
treated separately from normal results.  Depending on your database and configuration,
the entire inserted row may be available.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Unfortunately there is a lot of variation between databases supporting
this feature so please test this feature&#8217;s interaction with your database thoroughly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In PostgreSQL, the entire row is available, so you can immediately
map your inserted names back to full User objects!  This avoids the
overhead of separately querying after the insert completes.</p>
</div>
<div class="paragraph">
<p>Consider the following table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">User</span> {
    <span class="directive">final</span> <span class="type">int</span> id;
    <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> User(<span class="type">int</span> id, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="annotation">@Before</span>
<span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
    db.useHandle(h -&gt; h.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE users (id SERIAL PRIMARY KEY, name VARCHAR)</span><span class="delimiter">&quot;</span></span>));
    db.registerRowMapper(ConstructorMapper.factory(User.class));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can get generated keys in the fluent style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> fluentInsertKeys() {
    db.useHandle(handle -&gt; {
        User data = handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO users (name) VALUES(?)</span><span class="delimiter">&quot;</span></span>)
                .bind(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Data</span><span class="delimiter">&quot;</span></span>)
                .executeAndReturnGeneratedKeys()
                .mapTo(User.class)
                .findOnly();

        assertEquals(<span class="integer">1</span>, data.id); <span class="comment">// This value is generated by the database</span>
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Data</span><span class="delimiter">&quot;</span></span>, data.name);
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>SqlObject style works just as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> sqlObjectBatchKeys() {
    db.useExtension(UserDao.class, dao -&gt; {
        <span class="predefined-type">List</span>&lt;User&gt; users = dao.createUsers(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>);
        assertEquals(<span class="integer">3</span>, users.size());

        assertEquals(<span class="integer">1</span>, users.get(<span class="integer">0</span>).id);
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, users.get(<span class="integer">0</span>).name);

        assertEquals(<span class="integer">2</span>, users.get(<span class="integer">1</span>).id);
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, users.get(<span class="integer">1</span>).name);

        assertEquals(<span class="integer">3</span>, users.get(<span class="integer">2</span>).id);
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>, users.get(<span class="integer">2</span>).name);
    });
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
    <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO users (name) VALUES(?)</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@GetGeneratedKeys</span>
    <span class="predefined-type">List</span>&lt;User&gt; createUsers(<span class="predefined-type">String</span>... names);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transactions"><a class="anchor" href="#_transactions"></a>3.9. Transactions</h3>
<div class="paragraph">
<p><strong>jdbi</strong> provides full support for JDBC transactions.</p>
</div>
<div class="sect3">
<h4 id="_transactions_in_the_fluent_api"><a class="anchor" href="#_transactions_in_the_fluent_api"></a>3.9.1. Transactions in the Fluent API</h4>
<div class="paragraph">
<p><strong>Handle</strong> objects provide two ways to open a transaction&#8201;&#8212;&#8201;<strong>inTransaction</strong> allows
you to return a result, and <strong>useTransaction</strong> has no return value.</p>
</div>
<div class="paragraph">
<p>Both optionally allow you to specify the transaction isolation level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Optional&lt;User&gt; findUserById(<span class="type">long</span> id) {
    <span class="keyword">return</span> handle.inTransaction(h -&gt;
            h.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM users WHERE id=:id</span><span class="delimiter">&quot;</span></span>)
                    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, id)
                    .mapTo(User.class)
                    .findFirst());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we (probably unnecessarily) guard a simple <em>SELECT</em> statement with a
transaction.</p>
</div>
</div>
<div class="sect3">
<h4 id="_transactions_in_sqlobject_api"><a class="anchor" href="#_transactions_in_sqlobject_api"></a>3.9.2. Transactions in SqlObject API</h4>
<div class="paragraph">
<p>Similarly, you may declare transactions with SqlObject annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> sqlObjectTransaction() {
    assertThat(handle.attach(UserDao.class).findUserById(<span class="integer">3</span>).map(u -&gt; u.name)).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM users WHERE id=:id</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Transaction</span>
    Optional&lt;User&gt; findUserById(<span class="type">int</span> id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>SQL methods with a <code>@Transaction</code> annotation may optionally specify a transaction isolation level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO USERS (name) VALUES (:name)</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Transaction</span>(TransactionIsolationLevel.READ_COMMITTED)
<span class="type">void</span> insertUser(<span class="predefined-type">String</span> name);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a <code>@Transaction</code> method calls another <code>@Transaction</code> method, they must specify the same isolation level, or the
inner method must not specify anything, in which case the isolation level of the outer method is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transaction</span>(TransactionIsolationLevel.READ_UNCOMMITTED)
<span class="keyword">default</span> <span class="type">void</span> outerMethodCallsInnerWithSameLevel() {
    <span class="comment">// this works: isolation levels agree</span>
    innerMethodSameLevel();
}

<span class="annotation">@Transaction</span>(TransactionIsolationLevel.READ_UNCOMMITTED)
<span class="keyword">default</span> <span class="type">void</span> innerMethodSameLevel() {}

<span class="annotation">@Transaction</span>(TransactionIsolationLevel.READ_COMMITTED)
<span class="keyword">default</span> <span class="type">void</span> outerMethodWithLevelCallsInnerMethodWithNoLevel() {
    <span class="comment">// this also works: inner method doesn't specify a level, so the outer method controls.</span>
    innerMethodWithNoLevel();
}

<span class="annotation">@Transaction</span>
<span class="keyword">default</span> <span class="type">void</span> innerMethodWithNoLevel() {}

<span class="annotation">@Transaction</span>(TransactionIsolationLevel.REPEATABLE_READ)
<span class="keyword">default</span> <span class="type">void</span> outerMethodWithOneLevelCallsInnerMethodWithAnotherLevel() <span class="directive">throws</span> TransactionException {
    <span class="comment">// error! inner method specifies a different isolation level.</span>
    innerMethodWithADifferentLevel();
}

<span class="annotation">@Transaction</span>(TransactionIsolationLevel.SERIALIZABLE)
<span class="keyword">default</span> <span class="type">void</span> innerMethodWithADifferentLevel() {}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_serializable_transactions"><a class="anchor" href="#_serializable_transactions"></a>3.9.3. Serializable Transactions</h4>
<div class="paragraph">
<p>For more advanced queries, sometimes serializable transactions are required.
<strong>jdbi</strong> includes a transaction runner that is able to retry transactions that
abort due to serialization failures.  It is important that your transaction
does not have side effects as it may be executed multiple times.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IntListDao</span> {
    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE ints (value INTEGER)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> create();

    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT sum(value) FROM ints</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span> sum();

    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO ints(value) VALUES(:value)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> insert(<span class="type">int</span> value);
}

<span class="directive">static</span> <span class="type">class</span> <span class="class">SumAndInsert</span> <span class="directive">implements</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Integer</span>&gt;, HandleCallback&lt;<span class="predefined-type">Integer</span>, <span class="exception">Exception</span>&gt; {
    <span class="directive">private</span> <span class="directive">final</span> Jdbi db;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">CountDownLatch</span> latch;

    <span class="directive">public</span> SumAndInsert(<span class="predefined-type">CountDownLatch</span> latch, Jdbi db) {
        <span class="local-variable">this</span>.latch = latch;
        <span class="local-variable">this</span>.db = db;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> withHandle(Handle handle) <span class="directive">throws</span> <span class="exception">Exception</span> {
        IntListDao dao = handle.attach(IntListDao.class);
        <span class="type">int</span> sum = dao.sum();

        <span class="comment">// First time through, make sure neither transaction writes until both have read</span>
        latch.countDown();
        latch.await();

        <span class="comment">// Now do the write.</span>
        dao.insert(sum);
        <span class="keyword">return</span> sum;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> call() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// Get a connection and run the transaction</span>
        <span class="keyword">return</span> db.inTransaction(TransactionIsolationLevel.SERIALIZABLE, <span class="local-variable">this</span>);
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> serializableTransaction() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">// Automatically rerun transactions</span>
    db.setTransactionHandler(<span class="keyword">new</span> SerializableTransactionRunner());

    <span class="comment">// Set up some values</span>
    IntListDao dao = handle.attach(IntListDao.class);
    dao.create();
    dao.insert(<span class="integer">10</span>);
    dao.insert(<span class="integer">20</span>);

    <span class="predefined-type">ExecutorService</span> executor = <span class="predefined-type">Executors</span>.newCachedThreadPool();
    <span class="predefined-type">CountDownLatch</span> latch = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">2</span>);

    <span class="comment">// Both of these would calculate 10 + 20 = 30, but that violates serialization!</span>
    SumAndInsert txn1 = <span class="keyword">new</span> SumAndInsert(latch, db);
    SumAndInsert txn2 = <span class="keyword">new</span> SumAndInsert(latch, db);

    <span class="predefined-type">Future</span>&lt;<span class="predefined-type">Integer</span>&gt; result1 = executor.submit(txn1);
    <span class="predefined-type">Future</span>&lt;<span class="predefined-type">Integer</span>&gt; result2 = executor.submit(txn2);

    <span class="comment">// One of them gets 30, the other gets 10 + 20 + 30 = 60</span>
    <span class="comment">// This assertion fails under any isolation level below SERIALIZABLE!</span>
    assertThat(result1.get() + result2.get()).isEqualTo(<span class="integer">30</span> + <span class="integer">60</span>);

    executor.shutdown();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above test is designed to run two transactions in lock step.
Each attempts to read the sum of all rows in the table, and then
insert a new row with that sum.  We seed the table with the values
10 and 20.</p>
</div>
<div class="paragraph">
<p>Without serializable isolation, each transaction reads 10 and 20, and
then returns 30.  The end result is 30 + 30 = 60, which does not
correspond to any serial execution of the transactions!</p>
</div>
<div class="paragraph">
<p>With serializable isolation, one of the two transactions is forced
to abort and retry.  On the second go around, it calculates 10 + 20 + 30 = 60.
Adding to 30 from the other, we get 30 + 60 = 90 and the assertion succeeds.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_batch_updates"><a class="anchor" href="#_batch_updates"></a>3.10. Batch Updates</h3>
<div class="paragraph">
<p>Normally, every statement executed requires a round-trip to the database server.
When inserting or updating a large number of records, this can add unacceptable
amounts of latency.  JDBC provides support for batching independent statements via
<a href="http://docs.oracle.com/javase/8/docs/api/java/sql/Statement.html#executeBatch--">Statement.executeBatch</a>
as well as a single statement with many varying bound arguments via
<a href="http://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#addBatch--">PreparedStatement.addBatch</a>.</p>
</div>
<div class="paragraph">
<p><strong>jdbi</strong> exposes this functionality through the <strong>Batch</strong> and <strong>PreparedBatch</strong> classes.
Their use is straightforward.  To execute many separate statements as a single batch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> testSimpleBatch() {
    Batch batch = handle.createBatch();

    batch.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO fruit VALUES(0, 'apple')</span><span class="delimiter">&quot;</span></span>);
    batch.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO fruit VALUES(1, 'banana')</span><span class="delimiter">&quot;</span></span>);

    <span class="type">int</span><span class="type">[]</span> rowsModified = batch.execute();
    assertThat(rowsModified).containsExactly(<span class="integer">1</span>, <span class="integer">1</span>);
    assertThat(handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT count(1) FROM fruit</span><span class="delimiter">&quot;</span></span>)
            .mapTo(<span class="type">int</span>.class)
            .findOnly()
            .intValue())
            .isEqualTo(<span class="integer">2</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a single statement but want to bind many groups of parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> testPreparedBatch() {
    PreparedBatch batch = handle.prepareBatch(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO fruit VALUES(:id, :name)</span><span class="delimiter">&quot;</span></span>);

    batch.bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>).bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>).add();
    batch.bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>).bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">banana</span><span class="delimiter">&quot;</span></span>).add();

    <span class="type">int</span><span class="type">[]</span> rowsModified = batch.execute();
    assertThat(rowsModified).containsExactly(<span class="integer">1</span>, <span class="integer">1</span>);
    assertThat(handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT count(1) FROM fruit</span><span class="delimiter">&quot;</span></span>)
            .mapTo(<span class="type">int</span>.class)
            .findOnly()
            .intValue())
            .isEqualTo(<span class="integer">2</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also support SqlObject batch inserts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> testSqlObjectBatch() {
    BasketOfFruit basket = handle.attach(BasketOfFruit.class);

    <span class="type">int</span><span class="type">[]</span> rowsModified = basket.fillBasket(<span class="predefined-type">Arrays</span>.asList(
            <span class="keyword">new</span> Fruit(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>),
            <span class="keyword">new</span> Fruit(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">banana</span><span class="delimiter">&quot;</span></span>)));

    assertThat(rowsModified).containsExactly(<span class="integer">1</span>, <span class="integer">1</span>);
    assertThat(basket.countFruit()).isEqualTo(<span class="integer">2</span>);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">BasketOfFruit</span> {
    <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO fruit VALUES(:id, :name)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span><span class="type">[]</span> fillBasket(<span class="annotation">@BindBean</span> <span class="predefined-type">Collection</span>&lt;Fruit&gt; fruits);

    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT count(1) FROM fruit</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span> countFruit();
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Fruit</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">int</span> id;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> name;

    Fruit(<span class="type">int</span> id, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.id = id; <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="type">int</span> getId() { <span class="keyword">return</span> id; }
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() { <span class="keyword">return</span> name; }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exception_rewriting"><a class="anchor" href="#_exception_rewriting"></a>3.11. Exception Rewriting</h3>
<div class="paragraph">
<p>The JDBC SQLException class is very old and predates more modern exception facilities like
Throwable&#8217;s suppressed exceptions.  When a batch fails, there may be multiple failures to
report, which could not be represented by the base Exception types of the day.</p>
</div>
<div class="paragraph">
<p>So SQLException has a bespoke
<a href="http://docs.oracle.com/javase/8/docs/api/java/sql/SQLException.html#getNextException--">getNextException</a>
chain to represent the causes of a batch failure.  Unfortunately, by default most logging libraries
do not print these exceptions out, pushing their handling into your code.  It is very common
to forget to handle this situation and end up with logs that say nothing other than</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.sql.BatchUpdateException: Batch entry 1 insert into something (id, name) values (0, '') was aborted.  Call getNextException to see the cause.</pre>
</div>
</div>
<div class="paragraph">
<p><strong>jdbi</strong> will attempt to rewrite such nextExceptions into "suppressed exceptions" (new in Java 8) so that your logs are more helpful:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.sql.BatchUpdateException: Batch entry 1 insert into something (id, name) values (0, 'Keith') was aborted.  Call getNextException to see the cause.
Suppressed: org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "something_pkey"
  Detail: Key (id)=(0) already exists.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sqlobject"><a class="anchor" href="#_sqlobject"></a>4. SqlObject</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__singlevalue"><a class="anchor" href="#__singlevalue"></a>4.1. @SingleValue</h3>
<div class="paragraph">
<p>Sometimes when using advanced SQL features like Arrays,
a container type like <code>int[]</code> or <code>List&lt;Integer&gt;</code> can
ambiguously mean either "a single SQL int[]" or
"a ResultSet of int".  Since arrays are not commonly
used in normalized schema, jdbi assumes that you are collecting
a ResultSet into a container object.  You can annotate a return
type as <code>@SingleValue</code> to override this.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sql_locators"><a class="anchor" href="#_sql_locators"></a>4.2. Sql Locators</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_third_party_integration"><a class="anchor" href="#_third_party_integration"></a>5. Third Party Integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_spring"><a class="anchor" href="#_spring"></a>5.1. Spring</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_google_guava"><a class="anchor" href="#_google_guava"></a>5.2. Google Guava</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_postgresql"><a class="anchor" href="#_postgresql"></a>5.3. PostgreSQL</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_oracle"><a class="anchor" href="#_oracle"></a>5.4. Oracle</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_kotlin"><a class="anchor" href="#_kotlin"></a>5.5. Kotlin</h3>
<div class="paragraph">
<p><a href="http://kotlinlang.org/">Kotlin</a> support is provided by <strong>jdbi3-kotlin</strong> and <strong>jdbi3-kotlin-sqlobject</strong> modules.</p>
</div>
<div class="sect3">
<h4 id="_resultset_mapping"><a class="anchor" href="#_resultset_mapping"></a>5.5.1. ResultSet mapping</h4>
<div class="paragraph">
<p>The <strong>jdbi3-kotlin</strong> plugin adds ResultSet mapping to Kotlin data classes. It supports data classes where all
fields are present in the constructor as well as classes with writable properties. Any fields not present in the
constructor will be set after the constructor call. The mapper supports nullable types. It also uses default
parameter values in the constructor if the parameter type is not nullable and the value absent in the result set.</p>
</div>
<div class="paragraph">
<p>Result set mapper also supports <code>@ColumnName</code> annotation that allows to specify name for a property or parameter explicitly.</p>
</div>
<div class="paragraph">
<p>If you load all Jdbi plugins via
<code>Jdbi.installPlugins()</code> this plugin will be discovered and registered automatically.
Otherwise, you can attach it using <code>Jdbi.installPlugin(KotlinPlugin())</code>.</p>
</div>
<div class="paragraph">
<p>An example from the test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">data class Thing(val id: Int, val name: String,
                 val nullable: String?,
                 val nullableDefaultedNull: String? = null,
                 val nullableDefaultedNotNull: String? = &quot;not null&quot;,
                 val defaulted: String = &quot;default value&quot;)
@Test fun testFindById() {
    val qry = db.sharedHandle.createQuery(&quot;select id, name from something where id = :id&quot;)
    val things: List&lt;Thing&gt; = qry.bind(&quot;id&quot;, brian.id).mapTo&lt;Thing&gt;().list()
    assertEquals(1, things.size)
    assertEquals(brian, things[0])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two extensions to help:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;reified T : Any&gt;ResultBearing.mapTo()</code></p>
</li>
<li>
<p><code>&lt;T : Any&gt;ResultIterable&lt;T&gt;.useSequence(block: (Sequence&lt;T&gt;) &#8594; Unit)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Allowing code like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val qry = handle.createQuery(&quot;select id, name from something where id = :id&quot;)
val things = qry.bind(&quot;id&quot;, brian.id).mapTo&lt;Thing&gt;.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>and for using a Sequence that is auto closed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">qryAll.mapTo&lt;Thing&gt;.useSequence {
    it.forEach(::println)
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sqlobject_2"><a class="anchor" href="#_sqlobject_2"></a>5.5.2. SqlObject</h4>
<div class="paragraph">
<p>The <strong>jdbi3-kotlin-sqlobject</strong> plugin adds automatic parameter binding by name for Kotlin methods in SqlObjects as well as support
for Kotlin default methods.</p>
</div>
<div class="paragraph">
<p>Parameter binding supports individual primitive types as well as Kotlin or JavaBean style objects as a parameter
(referenced in binding as <code>:paramName.propertyName</code>).  No annotations are needed.</p>
</div>
<div class="paragraph">
<p>If you load all Jdbi plugins via
<code>Jdbi.installPlugins()</code> this plugin will be discovered and registered automatically.
Otherwise, you can attach the plugin via:  <code>Jdbi.installPlugin(KotlinSqlObjectPlugin())</code>.</p>
</div>
<div class="paragraph">
<p>An example from the test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">interface ThingDao {
    @SqlUpdate(&quot;insert into something (id, name) values (:something.id, :something.name)&quot;)
    fun insert(something: Thing)

    @SqlQuery(&quot;select id, name from something&quot;)
    fun list(): List&lt;Thing&gt;
}
@Before fun setUp() {
    val dao = db.jdbi.onDemand&lt;ThingDao&gt;()

    val brian = Thing(1, &quot;Brian&quot;, null)
    val keith = Thing(2, &quot;Keith&quot;, null)

    dao.insert(brian)
    dao.insert(keith)
}
@Test fun testDao() {
    val dao = db.jdbi.onDemand&lt;ThingDao&gt;()

    val rs = dao.list()

    assertEquals(2, rs.size.toLong())
    assertEquals(brian, rs[0])
    assertEquals(keith, rs[1])

}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix"><a class="anchor" href="#_appendix"></a>6. Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_api_reference"><a class="anchor" href="#_api_reference"></a>6.1. API Reference</h3>
<div class="paragraph">
<p><a href="apidocs/index.html">Javadoc</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_contributing"><a class="anchor" href="#_contributing"></a>6.2. Contributing</h3>
<div class="paragraph">
<p><strong>jdbi</strong> uses GitHub for collaboration.  Please check out the
<a href="https://github.com/jdbi/jdbi">project page</a> for more
information.</p>
</div>
<div class="paragraph">
<p>If you have a question, we have a
<a href="https://groups.google.com/group/jdbi">Google Group mailing list</a></p>
</div>
<div class="paragraph">
<p>Users sometimes hang out on <a href="irc://irc.freenode.net/#jdbi">IRC in #jdbi on Freenode</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leftover_snippets"><a class="anchor" href="#_leftover_snippets"></a>7. Leftover snippets</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RegisterRowMapper</span>(SomethingMapper.class)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">SomethingDao</span>
{
    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO something (id, name) VALUES (:s.id, :s.name)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span> insert(<span class="annotation">@BindBean</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">s</span><span class="delimiter">&quot;</span></span>) Something s);

    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM something WHERE id = ?</span><span class="delimiter">&quot;</span></span>)
    Optional&lt;Something&gt; findSomething(<span class="type">int</span> id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given a type <strong>Something</strong> that has <strong>int id</strong> and <strong>String name</strong>
properties, we define an interface, <strong>SomethingDao</strong>, that
provides simple create and read operations for
a table.</p>
</div>
<div class="paragraph">
<p>Annotations at the class and method level control
the binding of arguments and mapping to results.
For example, <code>@RegisterRowMapper</code> mirrors
<code>Handle.registerRowMapper</code>.</p>
</div>
<div class="paragraph">
<p>You produce results as single instances
or container types like <code>Optional</code> or <code>List</code>,
same as <code>Query.mapTo</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dao.insert(<span class="keyword">new</span> Something(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>));
dao.insert(<span class="keyword">new</span> Something(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bison</span><span class="delimiter">&quot;</span></span>));

assertThat(dao.findSomething(<span class="integer">2</span>))
    .isPresent()
    .contains(<span class="keyword">new</span> Something(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bison</span><span class="delimiter">&quot;</span></span>));

assertThat(dao.findSomething(<span class="integer">3</span>))
    .isEmpty();</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are also <code>@SqlBatch</code> and <code>@SqlCall</code> annotations.
Check out the Javadoc for more information.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-04-19 00:30:58 MDT
</div>
</div>
</body>
</html>